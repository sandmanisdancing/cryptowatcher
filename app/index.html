<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>My Cryptowatcher</title>

  <link rel="canonical" href="https://sandmanisdancing.github.io/cryptowatcher/dist">
  <link rel="manifest" href="manifest.json">

  <!-- PWA icons, uncomment for production -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="My Cryptowatcher">
  <link rel="apple-touch-icon" href="images/icons/icon-152x152.png">

  <meta name="msapplication-TileImage" content="images/icons/icon-144x144.png">
  <meta name="msapplication-TileColor" content="#a008b7">

  <!-- shortcut icon, uncomment for production -->
  <!-- <link rel="shortcut icon" href="images/icons/icon-32x32.png" type="image/ico"> -->

  <link rel="stylesheet" type="text/css" href="styles/main.css" media="all">
  <link rel="stylesheet" type="text/css" href="styles/desktop.css" media="(min-width: 700px)">

  <link rel="preload" href="https://www.gstatic.com/firebasejs/4.1.3/firebase.js" as="script">
  <link rel="preload" href="scripts/main.js" as="script">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,500" as="style">

  <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,500" rel="stylesheet">

  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-102622704-1', 'auto');ga('send', 'pageview');</script>
  <script>
  var script = document.createElement('script');

  script.onload = function () {
    var fontRegular = new FontFaceObserver('Fira Sans Condensed'),
    fontItalic = new FontFaceObserver('Fira Sans Condensed');
    Promise.all([fontRegular.load(), fontItalic.load()]).then(function () {
      sessionStorage.fontsLoaded = true;
      document.body.classList.add('fonts-loaded');
    }).catch(function () {
      sessionStorage.fontsLoaded = false;
    });
  }

  script.src = "dist/scripts/fontfaceobserver.js";
  document.head.appendChild(script);</script>
</head>
<body>
  <div id="crypto-app" v-cloak>
    <header class="pageheader">
      <div class="load-status" v-if="loadStatus">{{ loadStatus }}</div>

      <div class="pageheader__left-column">
        <h1 class="pageheader__name">My crypto portfolio</h1>
        <div class="pageheader__user" v-if="authentication.isSignedIn">
          {{ authentication.user.email }}
        </div>
        <div class="pageheader__user" v-else>
          Not signed in.
        </div>
      </div>

      <div class="pageheader__buttons" :class="{ 'pageheader__buttons--si': authentication.isSignedIn }">
        <button class="btn btn--main" @click="openWindow">Add investment</button>
        <button class="btn btn--alt" @click="fetchData">Refresh data</button>

        <button data-device="desktop"  class="btn btn--main" @click="signIn" v-if="!authentication.isSignedIn">Sign in with Google</button>
        <button data-device="mobile" class="btn btn--main" @click="signIn('mobile')" v-if="!authentication.isSignedIn">Sign in with Google</button>
        <button class="btn btn--warning" @click="signOut" v-else>Sign out</button>
      </div>
    </header>

    <main role="main">
      <section class="portfolio">
        <div class="portfolio__filters" v-if="myInvestments.length">
          <input type="search" class="input-field portfolio__search" v-model="searchInv" placeholder="Search by symbol...">
          <button role="button" class="btn btn--alt" @click="tableFiltering.notListed = !tableFiltering.notListed">
            <span v-if="tableFiltering.notListed">Hide not listed</span>
            <span v-else>Show all</span>
          </button>
        </div>

        <div class="portfolio__table-holder">
          <table id="my-investments" class="table" v-if="myInvestments.length">
            <thead>
              <tr>
                <th class="table__th table__th--symbol">Symbol</th>
                <th class="table__th table__th--in-crypto">Invested, crypto</th>
                <th class="table__th table__th--in-usd">Invested</th>
                <th class="table__th table__th--stay-usd">Current crypto value</th>
                <th class="table__th table__th--quantity">Quantity</th>
                <th class="table__th table__th--current-price">Price</th>
                <th class="table__th table__th--total-usd">Total</th>
                <th class="table__th table__th--sell-usd">Sold</th>
                <th class="table__th table__th--sell-coins">Sold, coins&nbsp;/ tokens</th>
                <th class="table__th table__th--sell-total">Sold + total</th>
                <th class="table__th table__th--finish">ICO finish date</th>
                <th class="table__th table__th--action">Act</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(investment, index) in filteredInvestments" :key="investment.id" @click="highlightRow" class="table__row">
                <td class="table__td table__td--symbol">
                  <span class="table__symbol">
                    <img class="table__symbol-icon" :src="showCoinImage(investment.coinsSymbol)" :src="showCoinImage(investment.coinsSymbol)" :alt="investment.coinsSymbol + ' icon'" v-if="showCoinImage(investment.coinsSymbol)">
                    <span v-else class="table__symbol-icon">&minus;</span>

                    <template v-if="investment.url">
                      <a class="table__symbol-name" :title="investment.url" :href="investment.url" target="_blank" rel="noopener">{{ investment.coinsSymbol }}</a>
                    </template>
                    <span class="table__symbol-name" v-else>{{ investment.coinsSymbol }}</span>
                  </span>
                </td>
                <td class="table__td">{{ investment.cryptoInvestedAmount | roundToThreeDigits }}&nbsp;{{ investment.cryptoInvestedSymbol }}</td>
                <td class="table__td">
                  <span class="fiat"><span class="fiat__whole">${{ investment.usdInvested | tofixWhole }}</span>.<span class="fiat__fraction">{{ investment.usdInvested | tofixFraction }}</span></span>
                </td>
                <td class="table__td">
                  <span class="fiat"><span class="fiat__whole">${{ countRate(investment.cryptoInvestedAmount, investment.cryptoInvestedSymbol) | tofixWhole }}</span>.<span class="fiat__fraction">{{ countRate(investment.cryptoInvestedAmount, investment.cryptoInvestedSymbol) | tofixFraction }}</span>
                </td>
                <td class="table__td">{{ (investment.coinsAmount - investment.coinsWithdraw) | roundToThreeDigits }}</td>
                <td class="table__td table__td--current-price">
                  <a target="_blank" rel="noopener" title="Link to the list of markets" :href="showMarketsLink(investment.coinsSymbol)" v-if="showMarketsLink(investment.coinsSymbol)">${{ countRate(1, investment.coinsSymbol) | tofix2 }}</a>
                  <span v-else>${{ countRate(1, investment.coinsSymbol) | tofix2 }}</span>
                  <template v-if="show24hChange(investment.coinsSymbol) !== 0">
                    &nbsp;(<span :class="[show24hChange(investment.coinsSymbol) >= 0 ? 'table__positive-change' : 'table__negative-change']">{{ show24hChange(investment.coinsSymbol) }}%</span>)
                  </template>
                </td>
                <td class="table__td">
                  <span class="fiat"><span class="fiat__whole">${{ countRate(investment.coinsAmount - investment.coinsWithdraw, investment.coinsSymbol) | tofixWhole }}</span>.<span class="fiat__fraction">{{ countRate(investment.coinsAmount - investment.coinsWithdraw, investment.coinsSymbol) | tofixFraction }}</span></span>
                </td>
                <td class="table__td table__td--sell-usd">
                  <span class="fiat"><span class="fiat__whole">${{ investment.usdWithdraw | tofixWhole }}</span>.<span class="fiat__fraction">{{ investment.usdWithdraw | tofixFraction }}</span></span>
                </td>
                <td class="table__td">{{ investment.coinsWithdraw }}</td>
                <td class="table__td">
                  <span class="fiat"><span class="fiat__whole">${{ countSum(investment.usdWithdraw, countRate(investment.coinsAmount - investment.coinsWithdraw, investment.coinsSymbol)) | tofixWhole }}</span>.<span class="fiat__fraction">{{ countSum(investment.usdWithdraw, countRate(investment.coinsAmount - investment.coinsWithdraw, investment.coinsSymbol)) | tofixFraction }}</span></span>
                </td>
                <td class="table__td table__td--finish">
                  <acronym class="acronym" tabindex="0" v-if="investment.finishDate">
                    <span class="acronym__tooltip">{{ investment.finishDate | dateToDays }}</span>
                    <span class="acronym__text">{{ investment.finishDate }}</span>
                  </acronym>
                </td>
                <td class="table__td table__td--action">
                  <div class="table__action-div">
                    <button class="btn btn--main action-btn" type="button" @click="makeTransaction(index)" title="Transaction">
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="18" height="18" viewBox="0 0 45 45" xml:space="preserve">
                        <path d="M1.788,16.945c0.388,0.385,0.913,0.601,1.459,0.601l27.493-0.035v3.831c0.003,0.836,0.556,1.586,1.329,1.904	c0.771,0.314,1.658,0.135,2.246-0.459l9.091-9.18c1.062-1.071,1.06-2.801-0.009-3.868l-9.137-9.134	c-0.59-0.591-1.479-0.768-2.25-0.446c-0.77,0.319-1.271,1.074-1.27,1.908L30.74,5.9L3.219,5.937	C2.08,5.94,1.161,6.864,1.163,8.004l0.018,7.483C1.182,16.034,1.401,16.56,1.788,16.945z"/>
                        <path d="M42.146,27.901l-27.522-0.035l-0.001-3.834c0.002-0.835-0.5-1.587-1.27-1.907c-0.771-0.321-1.66-0.146-2.25,0.445	l-9.136,9.135c-1.067,1.064-1.071,2.796-0.009,3.866l9.09,9.181c0.588,0.596,1.475,0.772,2.247,0.458	c0.772-0.316,1.326-1.066,1.329-1.904v-3.83l27.493,0.035c0.547,0,1.072-0.216,1.459-0.602s0.605-0.91,0.607-1.456L44.2,29.97	C44.203,28.83,43.284,27.903,42.146,27.901z"/>
                      </svg>
                    </button>
                    <button class="btn btn--alt action-btn action-btn--edit" type="button" @click="editToken(index)" title="Edit">
                      <svg version="1.1" width="18" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" xml:space="preserve">
                        <path d="M984.1,122.3C946.5,84.5,911.4,42.1,867.8,11c-40-8.3-59.2,34.9-86.7,55.1c46.4,53.9,100.5,101.5,150.4,152.5C954.1,191.7,1007.7,164.1,984.1,122.3z M959.3,325.9c-31.7,31.8-64.5,62.8-95.1,95.8c-0.8,127.5,0.3,255-0.4,382.6c-0.6,47-41.8,88.7-88.8,90.3c-193.4,0.8-387,0.8-580.4,0.1c-52.2-1.4-94-51.4-89.9-102.7c-0.1-184.6-0.1-369.1,0-553.5c-4-51.1,38-100.3,89.6-102.1c128.1-1.7,256.3,0.1,384.3-0.9c33.2-30,63.9-62.9,95.7-94.5c-170.6,0-341-0.9-511.6,0.5c-79.6,1.4-151,71-152.4,151C10.1,407.7,9.5,622.8,10.7,838c0.3,77.5,66.1,144.7,142.4,152h670.2c72.3-12.7,134.3-75.8,135.2-150.9C960.7,668.1,959,496.9,959.3,325.9z M908.2,242.2C858,191.7,807.4,141.5,756.6,91.5C645.4,201.9,534,312,423.4,423c50.1,50.4,100.4,100.6,151.3,150.3C686,463.1,797.2,352.6,908.2,242.2z M341.2,654.6c68.1-18.5,104.4-30.2,172.5-48.5c18.2-5.8,30.3-9.3,39.7-13c-48.2-45.9-103.6-102.5-151.7-148.8C381.4,514.4,361.4,584.5,341.2,654.6z"></path>
                      </svg>
                    </button>
                    <button class="btn btn--warning action-btn action-btn--delete" type="button" @click="askRemoveToken(index)" title="Delete">
                      <svg version="1.1" width="18" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" xml:space="preserve">
                        <g><path d="M815.3,80.3h-190V10H372.6v70.3h-190v69.3h632.7V80.3z"></path><path d="M816.9,203.6H120v101.9h63.3V990H817V305.5h63V203.6L816.9,203.6L816.9,203.6z M365.6,890.8h-85.5V304.5h85.5V890.8z M542.5,890.8H457V304.5h85.5V890.8z M722.3,890.8h-85.5V304.5h85.5V890.8z"></path></g>
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div v-if="!myInvestments.length">
          <p class="portfolio__empty">You have not investments right now, please add some information:</p>
          <button class="btn btn--main" @click="openWindow">Add investment</button>
        </p>
      </section>

      <div class="columns">
        <section class="insights" v-if="myInvestments.length">
          <table class="table table--right-align" id="invest-calcs">
            <thead>
              <tr>
                <th class="table__th" colspan="2">Insights</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="table__td">Total portfolio value, USD</td>
                <td class="table__td">{{ totalPortfolioValue | tofix2 }}</td>
              </tr>
            </tbody>
          </table>
        </section>

        <aside class="market-info">
          <div class="market-info__search">
            <label for="search-currency" class="input-label market-info__search-label">Coin search</label>
            <input type="search" id="search-currency" class="input-field market-info__search-field" v-model="searchMarket" placeholder="Search by name...">
          </div>

          <table id="top10" class="table">
            <thead>
              <tr>
                <th class="table__th">Coin</th>
                <th class="table__th">Market cap</th>
                <th class="table__th">Price</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="n in 10" v-if="currencyListSearch[n-1]">
                <td class="table__td table__td--name">
                  <span class="table__symbol">
                    <img class="table__symbol-icon" :src="showCoinImage(currencyListSearch[n-1].id, false)" :alt="currencyListSearch[n-1].name + ' icon'">

                    <span class="table__symbol-name">{{ currencyListSearch[n-1].name }}</span>
                  </span>
                </td>
                <td class="table__td">${{ currencyListSearch[n-1].market_cap_usd | bigNumber }}</td>
                <td class="table__td table__td--price">
                  ${{ currencyListSearch[n-1].price_usd | tofix2 }}&nbsp;(<span :class="[currencyListSearch[n-1].percent_change_24h >= 0 ? 'table__positive-change' : 'table__negative-change']">{{ currencyListSearch[n-1].percent_change_24h }}%</span>)
                </td>
              </tr>
            </tbody>
          </table>
        </aside>
      </div>
    </main>

    <footer class="pagefooter">
      <div class="pagefooter__copy">
        <p>&copy; 2017 — you are able to use this app in the way you need.</p>
        <p>Built with <a href="http://coinmarketcap.com/" target="_blank" rel="noopener">Coinmarketcap API</a> and <a href="http://vuejs.org/" target="_blank" rel="noopener">Vue.js</a>.</p>
      </div>
      <div class="pagefooter__donate">
        <p>Donations are always appreciated.</p>
        <p>ETH <strong>0x9e41B796ac20320b462F9aCf896717c04302672C</strong></p>
        <p>BTC <strong>1NbwV5pqAJKaipM1pTQpdbisB3rwtKq6MF</strong></p>
      </div>
    </footer>

    <!-- POPUP -->

    <div class="popup-overlay" v-if="investPopup" @click="closeWindow('investPopup', $event)" v-on:keydown.esc="closeWindow('investPopup', $event)" tabindex="0">
      <section class="popup">
        <div class="popup__inner">
          <button type="button" class="popup__close" aria-label="Close dialog" title="Close dialog" @click="closeWindow('investPopup', $event)"></button>

          <article class="invest">
            <form action="#" @submit.prevent="createInvestment">
              <div class="invest__screen">
                <h3>Invested</h3>
                <div class="invest__columns">
                  <div class="invest__block">
                    <label for="crypto-spent" class="invest__label">Crypto quantity</label>
                    <div class="invest__line">
                      <input type="hidden" v-model="investTemplate.id">
                      <input type="number" v-model.number="investTemplate.cryptoInvestedAmount" id="crypto-spent" class="input-field" placeholder="0.361" min="0" step="any">
                      <select class="input-field" v-model="investTemplate.cryptoInvestedSymbol" required="true">
                        <option value="Crypto name" disabled>Crypto name</option>
                        <option v-for="currency in fullData" :value="currency.symbol">{{ currency.name }}</option>
                      </select>
                    </div>
                  </div>
                  <div class="invest__block">
                    <label for="usd-spent" class="invest__label">Invested in USD</label>
                    <div class="invest__line">
                      <input type="number" v-model.number="investTemplate.usdInvested" id="usd-spent" class="input-field" :placeholder="756.15" min="0" step="any">
                    </div>
                  </div>
                </div>
              </div>

              <div class="invest__screen">
                <h3>Got</h3>
                <div class="invest__columns">
                  <div class="invest__block">
                    <label for="coins-amount" class="invest__label">Coins / tokens quantity</label>
                    <div class="invest__line">
                      <input type="number" v-model.number="investTemplate.coinsAmount" id="coins-amount" class="input-field" placeholder="983.4458" min="0" step="any">
                    </div>
                  </div>
                  <div class="invest__block">
                    <label for="coins-symbol" class="invest__label">Symbol for coins / tokens<span class="secondary-span">, i.e. BNT for Bancor</span></label>
                    <div class="invest__line">
                      <input type="text" v-model="investTemplate.coinsSymbol" id="coins-symbol" class="input-field" placeholder="BNT" required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="invest__screen">
                <h3>Meta info</h3>
                <div class="invest__columns">
                  <div class="invest__block">
                    <label for="finish-date" class="invest__label">Finish date</label>
                    <div class="invest__line">
                      <input type="date" v-model="investTemplate.finishDate" id="finish-date" class="input-field">
                    </div>
                  </div>
                  <div class="invest__block">
                    <label for="prj-url" class="invest__label">Project website</label>
                    <div class="invest__line">
                      <input type="url" v-model="investTemplate.url" id="prj-url" class="input-field" placeholder="https://tezos.com">
                    </div>
                  </div>
                </div>
                <p>If you don’t know all info for now, it's ok, you can always edit this information.</p>
              </div>

              <p class="invest__done">
                <button class="btn btn--main">Save</button>
              </p>
            </form>
          </article>
        </div>
      </section>
    </div>

    <div class="popup-overlay" v-if="transactionPopup" @click="closeWindow('transactionPopup', $event)" v-on:keydown.esc="closeWindow('transactionPopup', $event)" tabindex="0">
      <section class="popup popup--transaction">
        <div class="popup__inner">
          <button type="button" class="popup__close" aria-label="Close dialog" title="Close dialog" @click="closeWindow('transactionPopup', $event)"></button>

          <form action="#" @submit.prevent="createTransaction">
            <div class="invest__screen">
              <h3>Sold</h3>
              <input type="hidden" v-model="investTemplate.id">
              <div class="invest__columns">
                <div class="invest__block">
                  <label for="tokens-withdraw" class="invest__label">Sold, quantity</label>
                  <div class="invest__line">
                    <input type="number" v-model.number="investTemplate.coinsWithdrawTemp" id="tokens-withdraw" class="input-field" step="any">
                  </div>
                </div>
                <div class="invest__block">
                  <label for="usd-withdraw" class="invest__label">Sell sum, USD</label>
                  <div class="invest__line">
                    <input type="number" v-model.number="investTemplate.usdWithdrawTemp" id="usd-withdraw" class="input-field" step="any">
                  </div>
                </div>
              </div>
            </div>

            <div class="invest__screen">
              <h3>Result</h3>
              <p>Total sold, coins / tokens: {{ coinsSold }}</p>
              <p>Total sell sum, USD: {{ usdGot }}</p>
            </div>

            <p class="invest__done">
              <button class="btn btn--main">Save</button>
            </p>
          </form>
        </div>
      </section>
    </div>

    <div class="popup-overlay" v-if="deletePopup" @click="closeWindow('deletePopup', $event)" v-on:keydown.esc="closeWindow('deletePopup', $event)" tabindex="0">
      <section class="popup popup--delete">
        <button type="button" class="popup__close" aria-label="Close dialog" title="Close dialog" @click="closeWindow('deletePopup', $event)"></button>

        <div class="popup__inner">
          <p>Are you sure you want to delete this entry?</p>
          <button class="btn btn--warning" type="button" @click="removeToken(deleteIndex)">Yes, delete it</button>
        </div>
      </section>
    </div>
  </div>


  <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js" defer></script>
  <script src="scripts/main.js" defer></script>
</body>
</html>
